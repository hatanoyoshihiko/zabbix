---
- name: Zabbix-server install check
  dnf:
    list: zabbix-server
  register: dnf_check_server

- name: Download RPM packages
  command: rpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/8/x86_64/zabbix-release-5.0-1.el8.noarch.rpm
  register: rpm

- name: Dnf package clean
  command: dnf clean
  when: rpm.results == 0

- name: Install zabbix server, frontend, agent
  dnf:
    name: "{{ zabbix_packages }}"
    vars:
      zabbix_packages:
        - zabbix-server-mysql
        - zabbix-web-mysql
        - zabbix-apache-conf
        - zabbix-agent
    state: latest

- name: Install Database Server
  dnf:
    name: "{ database_packages }"
    vars:
      database_packages:
        - mariadb
        - mariadb-server
        - mariadb-common
    state: latest
